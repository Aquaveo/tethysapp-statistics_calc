{% extends "statistics_calc/base.html" %}
{% load tethys_gizmos %}
{% load tethys_gizmos staticfiles %}

{% block app_content %}

    <div class="jumbotron jumbotron-fluid">
        <h1>Merge Two Datasets</h1>
        <p>
            Use this tool to merge two datasets based on their datetime value. Timezones can be applied to the
            timeseries if necessary. If timezones are applied to the timeseries data then interpolation will sometimes
            be required, so you will need to pick which timeseries you would like to interpolate (simulated or
            observed).
        </p>
    </div>

    <button onclick="checkVisible()">Check Visibility</button>

    <h2>Data Upload</h2>
    <hr>

    <h3>Observed Data</h3>
    <form name="merge_form" id="merge_form" method="post" enctype="multipart/form-data"
          action="/apps/statistics-calc/merged_csv_download/">
        {% csrf_token %}

        <div class="input-group">
            <label class="input-group-btn">
            <span class="btn btn-default waves-effect waves-light">
            CSV File Upload<input type="file" name="obs_csv" id="obs_csv" style="display: none;">
            </span>
            </label>
            <input type="text" id="obs_csv_name" class="form-control" readonly="">
        </div>

        <div id="obs_csv_error_message" style="display: none;"></div>

        <br>

        <input type="checkbox" name="observed-units" data-toggle="toggle" data-on="SI" data-off="BG"
               data-onstyle="success" data-offstyle="primary" data-size="normal" id="observed-units" checked>

        <br><br>

        <h3>Simulated Data</h3>

        <!--Making a radio box option to either upload their own data or use the SFPT forecast historical data-->
        <div class="btn-group btn-group-md" data-toggle="buttons">
            <label class="btn btn-default form-check-label waves-effect waves-light active">
                <input class="form-check-input" type="radio" autocomplete="off"
                       name="predicted_radio" value="upload">
                Upload Predicted Data (CSV)
            </label>
            <label class="btn btn-default form-check-label waves-effect waves-light">
                <input class="form-check-input" type="radio" autocomplete="off"
                       name="predicted_radio" value="sfpt">
                Use Streamflow Prediction Tool Historical Data
            </label>
        </div>

        <br><br>
        <!--Form for uploading simulated data-->
        <div class="sim_upload" id="upload" style="display:block">
            <div class="input-group">
                <label class="input-group-btn">
            <span class="btn btn-default waves-effect waves-light">
            CSV File Upload<input type="file" name="sim_csv" id="sim_csv" style="display: none;">
            </span>
                </label>
                <input type="text" id="sim_csv_name" class="form-control" readonly="">
            </div>

            <br>

            <input type="checkbox" name="simulated-units" id="simulated-units" data-toggle="toggle" data-on="SI"
                   data-off="BG" data-onstyle="success" data-offstyle="primary" data-size="normal" checked>
        </div>

        <!--Form for using the streamflow prediction tool data-->
        <div class="sim_upload" id="sfpt" style="display: none;">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="reach_id">Reach ID</label>
                    <input type="number" class="form-control form-fixer" id="reach_id">
                </div>
                <div class="form-group col-md-6">
                    <label for="watershed">Watershed</label>
                    <select id="watershed" name="watershed" class="form-control form-fixer">
                        {% for watershed in watersheds %}
                            <option value="{{ watershed }}">{{ watershed }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        {#    {% if not watershed_error %}#}
        {#        <label id="reach_id" style="display:none">Reach ID: <input></label>#}
        {#        <select id="select_watershed" name="watershed" style="display:none">#}
        {#        </select>#}
        {#    {% else %}#}
        {#        <label id="reach_id" style="display:none"><p style="color:red">There is a problem calling the API for#}
        {#            the watershed names, we are working to fix this. Please come back later.</p></label>#}
        {#    {% endif %}#}

        <h2>Timezones</h2>
        <hr>

        <h4>
            Do the timeseries have different timezones?
        </h4>

        <input type="checkbox" id="time_zone_bool" name="time_zone_bool" data-toggle="toggle" data-on="Yes"
               data-off="No"
               data-onstyle="success" data-offstyle="danger" data-size="small">

        <br><br>

        <!--Timezone Form-->
        <div id="timezone_form" style="display:none">

            {% gizmo obs_tz_select %}
            {% gizmo sim_tz_select %}

            <div class="btn-group btn-group-md" data-toggle="buttons">
                <label class="btn btn-default form-check-label waves-effect waves-light">
                    <input class="form-check-input" type="radio" autocomplete="off"
                           name="interpolate_radio" value="simulated">
                    Interpolate Simulated Data
                </label>
                <label class="btn btn-default form-check-label waves-effect waves-light">
                    <input class="form-check-input" type="radio" autocomplete="off"
                           name="interpolate_radio" value="observed">
                    Interpolate Observed Data
                </label>
            </div>

        </div>

        <br><br>

    </form>

    <button id="plot_merged" class="btn btn-success">Plot Merged Data</button>
    <button id="download_merged" class="btn btn-success">Download Merged Data</button>

    <div id="merged_hydrograph">{# Plot Goes Here #}</div>

{% endblock %}